# AWS EKS Terraform í”„ë¡œì íŠ¸

Terraformì„ ì‚¬ìš©í•˜ì—¬ AWS EKS(Elastic Kubernetes Service) í´ëŸ¬ìŠ¤í„°ë¥¼ ëª¨ë“ˆí™”ëœ êµ¬ì¡°ë¡œ ë°°í¬í•˜ëŠ” í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨

- [í”„ë¡œì íŠ¸ ê°œìš”](#-í”„ë¡œì íŠ¸-ê°œìš”)
- [ì•„í‚¤í…ì²˜](#-ì•„í‚¤í…ì²˜)
- [ë””ë ‰í† ë¦¬ êµ¬ì¡°](#-ë””ë ‰í† ë¦¬-êµ¬ì¡°)
- [ì‚¬ì „ ìš”êµ¬ì‚¬í•­](#-ì‚¬ì „-ìš”êµ¬ì‚¬í•­)
- [ë¹ ë¥¸ ì‹œì‘](#-ë¹ ë¥¸-ì‹œì‘)
- [ìƒì„¸ ê°€ì´ë“œ](#-ìƒì„¸-ê°€ì´ë“œ)
- [ë¹„ìš© ì˜ˆìƒ](#-ë¹„ìš©-ì˜ˆìƒ)
- [ë¬¸ì œ í•´ê²°](#-ë¬¸ì œ-í•´ê²°)
- [ì •ë¦¬](#-ì •ë¦¬)

---

## ğŸ¯ í”„ë¡œì íŠ¸ ê°œìš”

ì´ í”„ë¡œì íŠ¸ëŠ” ë‹¤ìŒì„ í¬í•¨í•©ë‹ˆë‹¤:

- **ëª¨ë“ˆí™”ëœ Terraform ì½”ë“œ**: ì¬ì‚¬ìš© ê°€ëŠ¥í•œ 5ê°œì˜ ëª¨ë“ˆ
- **Production-ready EKS í´ëŸ¬ìŠ¤í„°**: ê³ ê°€ìš©ì„± ë° ë³´ì•ˆ Best Practice ì ìš©
- **ì™„ì „í•œ ë„¤íŠ¸ì›Œí‚¹**: VPC, ì„œë¸Œë„·, NAT Gateway, ë¼ìš°íŒ…
- **ìë™í™”ëœ ë…¸ë“œ ê´€ë¦¬**: Managed Node Group with Auto Scaling

### êµ¬ì„±

- **EKS ë²„ì „**: 1.31
- **ë¦¬ì „**: ap-northeast-2 (ì„œìš¸)
- **VPC CIDR**: 10.100.0.0/16
- **ê°€ìš© ì˜ì—­**: 2ê°œ (ap-northeast-2a, ap-northeast-2c)
- **ë…¸ë“œ íƒ€ì…**: t3.medium (2 vCPU, 4GB RAM)
- **ë…¸ë“œ ìˆ˜**: ìµœì†Œ 2, ìµœëŒ€ 2

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AWS Region                           â”‚
â”‚                    ap-northeast-2                           â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  VPC (10.100.0.0/16)                â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚   AZ-2a             â”‚   AZ-2c             â”‚     â”‚  â”‚
â”‚  â”‚  â”‚                     â”‚                     â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Public       â”‚   â”‚  â”‚ Public       â”‚  â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ 10.100.1/24  â”‚   â”‚  â”‚ 10.100.2/24  â”‚  â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  â”‚              â”‚   â”‚  â”‚              â”‚  â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ NAT Gateway  â”‚   â”‚  â”‚ NAT Gateway  â”‚  â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚  â”‚
â”‚  â”‚  â”‚                     â”‚                     â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Private      â”‚   â”‚  â”‚ Private      â”‚  â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ 10.100.11/24 â”‚   â”‚  â”‚ 10.100.12/24 â”‚  â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  â”‚              â”‚   â”‚  â”‚              â”‚  â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ EKS Nodes    â”‚   â”‚  â”‚ EKS Nodes    â”‚  â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚              EKS Control Plane                      â”‚  â”‚
â”‚  â”‚         (AWS Managed, Multi-AZ)                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
terraform_test/
â”œâ”€â”€ bootstrap/                    # Backend ë¦¬ì†ŒìŠ¤ ìƒì„±ìš©
â”‚   â”œâ”€â”€ main.tf
â”‚   â”œâ”€â”€ variables.tf
â”‚   â””â”€â”€ outputs.tf
â”œâ”€â”€ modules/                      # ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ vpc/                     # VPC ë° ë„¤íŠ¸ì›Œí‚¹
â”‚   â”œâ”€â”€ iam/                     # IAM ì—­í•  ë° ì •ì±…
â”‚   â”œâ”€â”€ security-group/          # ë³´ì•ˆ ê·¸ë£¹
â”‚   â”œâ”€â”€ eks-cluster/             # EKS í´ëŸ¬ìŠ¤í„°
â”‚   â””â”€â”€ eks-node-group/          # EKS ë…¸ë“œ ê·¸ë£¹
â”œâ”€â”€ environments/                 # í™˜ê²½ë³„ ì„¤ì •
â”‚   â””â”€â”€ prod/                    # Production í™˜ê²½
â”‚       â”œâ”€â”€ main.tf              # ëª¨ë“ˆ ì¡°í•©
â”‚       â”œâ”€â”€ variables.tf         # ë³€ìˆ˜ ì •ì˜
â”‚       â”œâ”€â”€ terraform.tfvars     # ë³€ìˆ˜ ê°’
â”‚       â”œâ”€â”€ outputs.tf           # ì¶œë ¥ ê°’
â”‚       â”œâ”€â”€ providers.tf         # Provider ì„¤ì •
â”‚       â””â”€â”€ backend.tf           # Backend ì„¤ì •
â”œâ”€â”€ BACKEND_SETUP.md             # Backend ì„¤ì • ê°€ì´ë“œ
â”œâ”€â”€ plan.md                      # í”„ë¡œì íŠ¸ ê³„íšì„œ
â””â”€â”€ README.md                    # ì´ íŒŒì¼
```

---

## âœ… ì‚¬ì „ ìš”êµ¬ì‚¬í•­

1. **AWS CLI**: ì„¤ì¹˜ ë° êµ¬ì„± ì™„ë£Œ
   ```bash
   aws --version
   aws configure list
   ```

2. **Terraform**: ë²„ì „ 1.0 ì´ìƒ
   ```bash
   terraform version
   ```

3. **kubectl**: Kubernetes CLI (í´ëŸ¬ìŠ¤í„° ì ‘ê·¼ìš©)
   ```bash
   kubectl version --client
   ```

4. **AWS IAM ê¶Œí•œ**: ë‹¤ìŒ ì„œë¹„ìŠ¤ì— ëŒ€í•œ ê¶Œí•œ í•„ìš”
   - VPC, EC2, EKS
   - IAM (ì—­í•  ë° ì •ì±…)
   - S3, DynamoDB (Backendìš©)
   - CloudWatch Logs

---

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1ë‹¨ê³„: Backend ë¦¬ì†ŒìŠ¤ ìƒì„±

Terraform Stateë¥¼ ì €ì¥í•  S3 ë²„í‚·ê³¼ DynamoDB í…Œì´ë¸”ì„ ìƒì„±í•©ë‹ˆë‹¤.

```bash
# bootstrap ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd bootstrap

# Terraform ì´ˆê¸°í™”
terraform init

# ì‹¤í–‰ ê³„íš í™•ì¸
terraform plan

# ë¦¬ì†ŒìŠ¤ ìƒì„±
terraform apply

# ì¶œë ¥ëœ backend ì„¤ì •ì„ ë³µì‚¬í•´ë‘ì„¸ìš”
terraform output backend_config
```

### 2ë‹¨ê³„: Backend ì„¤ì • ì—…ë°ì´íŠ¸

`environments/prod/backend.tf` íŒŒì¼ì„ ì—´ê³  ì¶œë ¥ëœ S3 ë²„í‚· ì´ë¦„ìœ¼ë¡œ ì—…ë°ì´íŠ¸:

```hcl
terraform {
  backend "s3" {
    bucket         = "eks-terraform-state-<YOUR-ACCOUNT-ID>"  # ë³€ê²½
    key            = "prod/terraform.tfstate"
    region         = "ap-northeast-2"
    dynamodb_table = "eks-terraform-state-lock"
    encrypt        = true
  }
}
```

### 3ë‹¨ê³„: EKS í´ëŸ¬ìŠ¤í„° ë°°í¬

```bash
# prod í™˜ê²½ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd ../environments/prod

# Terraform ì´ˆê¸°í™” (Backend ì—°ê²°)
terraform init

# ì‹¤í–‰ ê³„íš í™•ì¸
terraform plan

# ë¦¬ì†ŒìŠ¤ ìƒì„± (ì•½ 15-20ë¶„ ì†Œìš”)
terraform apply
```

### 4ë‹¨ê³„: kubectl ì„¤ì •

```bash
# kubeconfig ì—…ë°ì´íŠ¸
aws eks update-kubeconfig --region ap-northeast-2 --name eks-cluster

# í´ëŸ¬ìŠ¤í„° í™•ì¸
kubectl get nodes
kubectl get pods -A
```

---

## ğŸ“š ìƒì„¸ ê°€ì´ë“œ

### ë³€ìˆ˜ ì»¤ìŠ¤í„°ë§ˆì´ì§•

`environments/prod/terraform.tfvars` íŒŒì¼ì„ ìˆ˜ì •í•˜ì—¬ ì„¤ì •ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```hcl
# í´ëŸ¬ìŠ¤í„° ì´ë¦„ ë³€ê²½
cluster_name = "my-eks-cluster"

# ë…¸ë“œ ìˆ˜ ë³€ê²½
desired_size = 3
max_size     = 5
min_size     = 3

# ì¸ìŠ¤í„´ìŠ¤ íƒ€ì… ë³€ê²½
instance_types = ["t3.large"]
```

### ëª¨ë“ˆ ì´í•´í•˜ê¸°

ê° ëª¨ë“ˆì€ ë…ë¦½ì ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ ê° ëª¨ë“ˆì˜ README.mdë¥¼ ì°¸ì¡°í•˜ì„¸ìš”:

- [VPC ëª¨ë“ˆ](modules/vpc/README.md)
- [IAM ëª¨ë“ˆ](modules/iam/README.md)
- [Security Group ëª¨ë“ˆ](modules/security-group/README.md)
- [EKS Cluster ëª¨ë“ˆ](modules/eks-cluster/README.md)
- [EKS Node Group ëª¨ë“ˆ](modules/eks-node-group/README.md)

### Backend ì„¤ì •

Terraform Stateë¥¼ ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì€ [BACKEND_SETUP.md](BACKEND_SETUP.md)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

---

## ğŸ’° ë¹„ìš© ì˜ˆìƒ

| ë¦¬ì†ŒìŠ¤ | ìˆ˜ëŸ‰ | ì˜ˆìƒ ë¹„ìš© (ì›”) |
|--------|------|----------------|
| EKS Control Plane | 1 | $73 |
| EC2 (t3.medium) | 2 | $60 |
| NAT Gateway | 2 | $65 |
| EBS (20GB) | 2 | $2 |
| CloudWatch Logs | - | $5 |
| **ì´ ì˜ˆìƒ ë¹„ìš©** | - | **ì•½ $205/ì›”** |

ë¹„ìš© ì ˆê° íŒ:
- NAT Gatewayë¥¼ 1ê°œë¡œ ì¤„ì´ê¸°: -$32.5/ì›”
- ë¡œê¹… ë¹„í™œì„±í™”: -$5/ì›”
- Spot ì¸ìŠ¤í„´ìŠ¤ ì‚¬ìš©: -$40/ì›”

---

## ğŸ› ë¬¸ì œ í•´ê²°

### 1. Backend ì´ˆê¸°í™” ì‹¤íŒ¨

**ë¬¸ì œ**: `terraform init` ì‹¤í–‰ ì‹œ Backend ì—°ê²° ì‹¤íŒ¨

**í•´ê²°**:
- bootstrapì„ ë¨¼ì € ì‹¤í–‰í–ˆëŠ”ì§€ í™•ì¸
- `backend.tf`ì˜ ë²„í‚· ì´ë¦„ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
- AWS ìê²© ì¦ëª…ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸

### 2. EKS í´ëŸ¬ìŠ¤í„° ìƒì„± ì‹¤íŒ¨

**ë¬¸ì œ**: `terraform apply` ì‹¤í–‰ ì‹œ EKS í´ëŸ¬ìŠ¤í„° ìƒì„± ì‹¤íŒ¨

**í•´ê²°**:
- IAM ê¶Œí•œ í™•ì¸
- ì„œë¹„ìŠ¤ ì¿¼í„° í™•ì¸ (ë¦¬ì „ë‹¹ EKS í´ëŸ¬ìŠ¤í„° ì œí•œ)
- VPC ì„œë¸Œë„· íƒœê·¸ í™•ì¸

### 3. kubectl ì ‘ê·¼ ë¶ˆê°€

**ë¬¸ì œ**: `kubectl get nodes` ì‹¤í–‰ ì‹œ ì ‘ê·¼ ë¶ˆê°€

**í•´ê²°**:
```bash
# kubeconfig ì¬ì„¤ì •
aws eks update-kubeconfig --region ap-northeast-2 --name eks-cluster

# AWS CLI ìê²© ì¦ëª… í™•ì¸
aws sts get-caller-identity

# í´ëŸ¬ìŠ¤í„° ìƒíƒœ í™•ì¸
aws eks describe-cluster --name eks-cluster --region ap-northeast-2
```

### 4. ë…¸ë“œê°€ Ready ìƒíƒœê°€ ì•ˆ ë¨

**ë¬¸ì œ**: ë…¸ë“œê°€ ê³„ì† NotReady ìƒíƒœ

**í•´ê²°**:
- VPC CNI í”ŒëŸ¬ê·¸ì¸ ìƒíƒœ í™•ì¸
- NAT Gateway ì‘ë™ í™•ì¸
- ë…¸ë“œ ë³´ì•ˆ ê·¸ë£¹ ê·œì¹™ í™•ì¸

---

## ğŸ§¹ ì •ë¦¬

### ì „ì²´ ì¸í”„ë¼ ì‚­ì œ

```bash
cd environments/prod
terraform destroy
```

### Backend ë¦¬ì†ŒìŠ¤ ì‚­ì œ (ì„ íƒì )

**ì£¼ì˜**: State íŒŒì¼ì´ ì†ì‹¤ë©ë‹ˆë‹¤!

```bash
cd ../../bootstrap
terraform destroy
```

### ìˆ˜ë™ ì •ë¦¬ê°€ í•„ìš”í•œ ë¦¬ì†ŒìŠ¤

- CloudWatch Logs ë¡œê·¸ ê·¸ë£¹
- ENI (Elastic Network Interface)
- ë¡œë“œ ë°¸ëŸ°ì„œ (ìƒì„±í•œ ê²½ìš°)

---

## ğŸ“– ì°¸ê³  ìë£Œ

- [Terraform AWS Provider](https://registry.terraform.io/providers/hashicorp/aws/latest/docs)
- [AWS EKS Best Practices](https://aws.github.io/aws-eks-best-practices/)
- [EKS User Guide](https://docs.aws.amazon.com/eks/latest/userguide/)
- [Kubernetes Documentation](https://kubernetes.io/docs/home/)

---

## ğŸ¤ ê¸°ì—¬

ì´ í”„ë¡œì íŠ¸ì— ê¸°ì—¬í•˜ê³  ì‹¶ìœ¼ì‹œë‹¤ë©´:

1. Fork the repository
2. Create your feature branch
3. Commit your changes
4. Push to the branch
5. Create a Pull Request

---

## ğŸ“ ë¼ì´ì„ ìŠ¤

This project is licensed under the MIT License.

---

## ğŸ‘¥ íŒ€

- **Environment**: prod
- **Project**: eks-project
- **Team**: Team Domodachi

---

**ìƒì„±ì¼**: 2025-11-20
**Terraform ë²„ì „**: >= 1.0
**AWS Provider ë²„ì „**: ~> 5.0
**EKS ë²„ì „**: 1.31
