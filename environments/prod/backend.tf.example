# Terraform Backend 설정 예제
#
# 이 파일을 복사하여 backend.tf로 저장하고 실제 값으로 변경하세요
#
# 사용 방법:
# 1. bootstrap을 먼저 실행하여 S3 버킷과 DynamoDB 테이블 생성
# 2. cp backend.tf.example backend.tf
# 3. backend.tf 파일을 열어서 실제 값으로 변경
# 4. backend.tf 파일은 절대 Git에 커밋하지 마세요!
#
# 주의사항:
# - backend 블록 내부에서는 변수(variable)를 사용할 수 없습니다
# - 모든 값을 하드코딩해야 합니다
# - 계정마다 S3 버킷 이름이 달라야 합니다 (전역 고유성)

terraform {
  backend "s3" {
    # S3 버킷 이름 (bootstrap 실행 후 출력된 값으로 변경)
    # 형식: eks-terraform-state-{YOUR_AWS_ACCOUNT_ID}
    # 예시: eks-terraform-state-123456789012
    bucket = "eks-terraform-state-YOUR_AWS_ACCOUNT_ID"

    # State 파일이 저장될 경로
    # 환경별로 다른 경로 사용 권장
    # dev: dev/terraform.tfstate
    # staging: staging/terraform.tfstate
    # prod: prod/terraform.tfstate
    key = "prod/terraform.tfstate"

    # AWS 리전 (S3 버킷이 생성된 리전과 동일해야 함)
    region = "ap-northeast-2"

    # DynamoDB 테이블 이름 (State Lock용)
    # bootstrap 실행 후 출력된 값으로 변경
    dynamodb_table = "eks-terraform-state-lock"

    # State 파일 암호화 활성화
    encrypt = true

    # 선택사항: KMS 키를 사용한 암호화
    # kms_key_id = "arn:aws:kms:ap-northeast-2:YOUR_AWS_ACCOUNT_ID:key/YOUR_KMS_KEY_ID"

    # 선택사항: AWS 프로파일 사용 (여러 계정 관리 시)
    # profile = "default"
  }
}

# ==================== Backend 설정 확인 방법 ====================
#
# 1. AWS 계정 ID 확인:
#    aws sts get-caller-identity --query Account --output text
#
# 2. S3 버킷 존재 확인:
#    aws s3 ls | grep terraform-state
#
# 3. DynamoDB 테이블 존재 확인:
#    aws dynamodb list-tables | grep terraform-state-lock
#
# 4. Backend 초기화:
#    terraform init
#
# 5. Backend 마이그레이션 (로컬에서 S3로):
#    terraform init -migrate-state

# ==================== 환경별 Backend 설정 예시 ====================
#
# Development 환경:
# terraform {
#   backend "s3" {
#     bucket         = "eks-terraform-state-123456789012"
#     key            = "dev/terraform.tfstate"
#     region         = "ap-northeast-2"
#     dynamodb_table = "eks-terraform-state-lock"
#     encrypt        = true
#   }
# }
#
# Staging 환경:
# terraform {
#   backend "s3" {
#     bucket         = "eks-terraform-state-123456789012"
#     key            = "staging/terraform.tfstate"
#     region         = "ap-northeast-2"
#     dynamodb_table = "eks-terraform-state-lock"
#     encrypt        = true
#   }
# }
#
# Production 환경:
# terraform {
#   backend "s3" {
#     bucket         = "eks-terraform-state-123456789012"
#     key            = "prod/terraform.tfstate"
#     region         = "ap-northeast-2"
#     dynamodb_table = "eks-terraform-state-lock"
#     encrypt        = true
#   }
# }
